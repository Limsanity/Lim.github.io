(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{447:function(e,t,i){"use strict";i.r(t);var r=i(46),v=Object(r.a)({},(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[i("h1",{attrs:{id:"使用pipeline加速redis查询"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#使用pipeline加速redis查询"}},[e._v("#")]),e._v(" 使用Pipeline加速Redis查询")]),e._v(" "),i("p",[i("a",{attrs:{href:"https://redis.io/topics/pipelining",target:"_blank",rel:"noopener noreferrer"}},[e._v("原文: Using pipelining to speedup Redis quries"),i("OutboundLink")],1)]),e._v(" "),i("h2",{attrs:{id:"request-response-protocol-and-rtt"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#request-response-protocol-and-rtt"}},[e._v("#")]),e._v(" Request/Response protocol and RTT")]),e._v(" "),i("p",[e._v("Redis采用客户端/服务端模型，即Request/Response protocol。")]),e._v(" "),i("p",[e._v("这意味着一个请求包括两个部分：")]),e._v(" "),i("ul",[i("li",[e._v("客户端发送查询请求至服务端。")]),e._v(" "),i("li",[e._v("服务端执行查询命令并返回响应。")])]),e._v(" "),i("p",[e._v("如果需要执行多个命令时就会存在多个往返延时(RTT)。")]),e._v(" "),i("p",[e._v("请求示例：")]),e._v(" "),i("ul",[i("li",[e._v("Client: INCR X")]),e._v(" "),i("li",[e._v("Server: 1")]),e._v(" "),i("li",[e._v("Client: INCR X")]),e._v(" "),i("li",[e._v("Server: 2")]),e._v(" "),i("li",[e._v("Client: INCR X")]),e._v(" "),i("li",[e._v("Server: 3")]),e._v(" "),i("li",[e._v("Client: INCR X")]),e._v(" "),i("li",[e._v("Servre: 4")])]),e._v(" "),i("h2",{attrs:{id:"redis-pipelining"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#redis-pipelining"}},[e._v("#")]),e._v(" Redis pipelining")]),e._v(" "),i("p",[e._v("可以通过客户端批量发送多个请求的方式加速查询。")]),e._v(" "),i("p",[e._v("请求示例：")]),e._v(" "),i("ul",[i("li",[e._v("Client: INCR X")]),e._v(" "),i("li",[e._v("Client: INCR X")]),e._v(" "),i("li",[e._v("Client: INCR X")]),e._v(" "),i("li",[e._v("Client: INCR X")]),e._v(" "),i("li",[e._v("Server: 1")]),e._v(" "),i("li",[e._v("Server: 2")]),e._v(" "),i("li",[e._v("Server: 3")]),e._v(" "),i("li",[e._v("Server: 4")])]),e._v(" "),i("p",[e._v("**注意：**服务端需要使用内存存储查询结果，然后批量返回。因此要合理设置每一批请求的查询数量。")]),e._v(" "),i("h2",{attrs:{id:"it-s-not-just-a-matter-of-rtt"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#it-s-not-just-a-matter-of-rtt"}},[e._v("#")]),e._v(" It's not just a matter of RTT")]),e._v(" "),i("p",[e._v("每一次查询都会涉及昂贵的"),i("code",[e._v("read()")]),e._v("、"),i("code",[e._v("write()")]),e._v("系统调用，从用户态切换至内核台，上下文切换也是一种性能消耗。")]),e._v(" "),i("h2",{attrs:{id:"pipelining-vs-scripting"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#pipelining-vs-scripting"}},[e._v("#")]),e._v(" Pipelining VS Scripting")]),e._v(" "),i("p",[e._v("TODO")]),e._v(" "),i("h2",{attrs:{id:"appendix-why-are-busy-loops-slow-even-on-the-loopback-interface"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#appendix-why-are-busy-loops-slow-even-on-the-loopback-interface"}},[e._v("#")]),e._v(" Appendix: Why are busy loops slow even on the loopback interface")]),e._v(" "),i("p",[e._v("即使所用Redis进程同处一个物理机也可存在缓慢操作。查询请求被写入至loopback interface缓冲中，等待Redis Server读取，而Redis Server进程需要被内核进行调度。此时可能被系统调用阻塞。")])])}),[],!1,null,null,null);t.default=v.exports}}]);