(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{459:function(t,e,n){"use strict";n.r(e);var a=n(46),s=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"引入配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#引入配置文件"}},[t._v("#")]),t._v(" 引入配置文件")]),t._v(" "),n("h3",{attrs:{id:"nginx-conf中添加引用文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf中添加引用文件"}},[t._v("#")]),t._v(" nginx.conf中添加引用文件")]),t._v(" "),n("ul",[n("li",[t._v("在nginx.conf文件中的http模块中添加"),n("code",[t._v("include /usr/local/nginx/conf/your_directory/*.conf")])])]),t._v(" "),n("h3",{attrs:{id:"编写配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编写配置文件"}},[t._v("#")]),t._v(" 编写配置文件")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("在"),n("code",[t._v("/usr/local/nginx/conf/")]),t._v("目录下新建一个存放配置文件的文件夹，例如"),n("code",[t._v("mkdir cr")])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("cd cr")]),t._v("，添加cr.conf")]),t._v(" "),n("ul",[n("li",[t._v("alias的意思是指，当请求"),n("code",[t._v("129.204.209.69/static/images/…")]),t._v("到来的时候，将alias指定的目录作为对应目录；和root的区别在于，root的值后面才拼接上"),n("code",[t._v("/static/images/...")])]),t._v(" "),n("li",[t._v("expires指定过期时间")]),t._v(" "),n("li",[t._v("autoindex为on时会为当前路径建立索引，客户可以访问到，否则无法访问，显示403 forbidden")]),t._v(" "),n("li",[t._v("注意: 这里使用了服务器本地目录作为图片资源目录，nginx可能没有权限访问目录，因此要在nginx.conf中添加"),n("code",[t._v("user root")]),t._v("设置用户")]),t._v(" "),n("li",[t._v("proxy_pass指定访问129.204.209.69的请求，代理到"),n("code",[t._v("cr")]),t._v("变量中，也就是上面设置的upstream，请求变成"),n("code",[t._v("localhost:3000/...")])]),t._v(" "),n("li",[t._v("proxy_cache和proxy_cache_key与缓存相关（待补充）")]),t._v(" "),n("li",[t._v("location的匹配是有顺序的")])])])]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("upstream cr {\n\tserver localhost:3000\n\tkeepalive 64;\n}\n\nproxy_cache_path /usr/local/nginx/cache/ levels=1:2 keys_zone=cache:512m inactive=1d max_size=8g;\n\nserver {\n\tlisten 80;\n\tserver_name 129.204.209.69;\n\t\n\tlocation /static/images/ {\n\t\talias /root/Clash-Royale-PWA/dist/static/images;\n\t\texpires 7d;\n\t\t# autoindex on;\n\t}\n\t\n\tlocation ~*\\.(js|css)$ {\n\t\tproxy_pass http://cr;\n\t\tproxy_cache cache;\n\t\tproxy_cache_key $uri$is_args$args;\n\t\texpires 7d;\n\t\tproxy_set_header X-Nginx-Proxy true;\n\t}\n\t\n\tlocation / {\n\t\tproxy_pass http://cr\n\t}\n}\n")])])]),n("h3",{attrs:{id:"重启nginx服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重启nginx服务"}},[t._v("#")]),t._v(" 重启nginx服务")]),t._v(" "),n("p",[n("code",[t._v("nginx -s reload")])]),t._v(" "),n("h3",{attrs:{id:"sendfile指令的作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sendfile指令的作用"}},[t._v("#")]),t._v(" sendfile指令的作用")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("见"),n("a",{attrs:{href:"https://www.jianshu.com/p/70e1c396c320",target:"_blank",rel:"noopener noreferrer"}},[t._v("sendfile的作用"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[t._v("避免数据在内核缓冲区和用户缓冲区之间的拷贝，操作效率高，称为零拷贝")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);