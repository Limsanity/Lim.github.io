(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{366:function(e,s,t){e.exports=t.p+"assets/img/1.b729eb26.png"},367:function(e,s,t){e.exports=t.p+"assets/img/2.029ce8a8.png"},368:function(e,s,t){e.exports=t.p+"assets/img/3.18906bf1.png"},369:function(e,s,t){e.exports=t.p+"assets/img/4.a6f52ca0.png"},432:function(e,s,t){"use strict";t.r(s);var a=t(46),r=Object(a.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"kubernetes命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes命令"}},[e._v("#")]),e._v(" Kubernetes命令")]),e._v(" "),a("h3",{attrs:{id:"更新deployment中的镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新deployment中的镜像"}},[e._v("#")]),e._v(" 更新deployment中的镜像：")]),e._v(" "),a("p",[e._v("本地更新docker镜像，build时指定tag")]),e._v(" "),a("p",[e._v("deployment.yaml中更新image字段的值：")]),e._v(" "),a("p",[a("img",{attrs:{src:t(366),alt:""}})]),e._v(" "),a("p",[a("code",[e._v("kubectl apply -f deployment.yaml")]),e._v(" 更新")]),e._v(" "),a("p",[e._v("如果pull的是private镜像，则可能出错，查看原因：")]),e._v(" "),a("p",[a("code",[e._v("kubectl get all -n my-components")])]),e._v(" "),a("p",[a("img",{attrs:{src:t(367),alt:""}})]),e._v(" "),a("p",[e._v("进入对应的pod中查看原因可以未登录docker hub：")]),e._v(" "),a("p",[a("code",[e._v("kubectl describe pod my-components-867977bc94-xfm6v -n my-components")])]),e._v(" "),a("p",[a("img",{attrs:{src:t(368),alt:""}})]),e._v(" "),a("p",[e._v("创建secret：")]),e._v(" "),a("p",[e._v("注意要指定namespace，否则即使下面yaml制定了imagePullSecrets也无效。kubectl edit secret变更namespace不会生效。")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl create secret docker-registry regsecret --namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("my-components --docker-server"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("https://index.docker.io/v1/ --docker-username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("limsanity3 --docker-password"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("xxxxx --docker-email"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("798607646")]),e._v("@qq.com\n")])])]),a("p",[e._v("查看secret：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get secret regsecret --output"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("yaml\n")])])]),a("p",[e._v("查看"),a("code",[e._v(".dockerconfigjson")]),e._v("内容：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl get secret regsecret --output"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"jsonpath={.data.\\.dockerconfigjson}"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" base64 --decode\n")])])]),a("p",[e._v("查看"),a("code",[e._v("auth")]),e._v("内容：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"c3R...zE2"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" base64 --decode\n")])])]),a("p",[e._v("输出是username:password。注意auth字段的值和"),a("code",[e._v("~/.docker/config.json")]),e._v("中的值一致。")]),e._v(" "),a("p",[a("img",{attrs:{src:t(369),alt:""}})]),e._v(" "),a("p",[e._v("回滚更新：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl rollout undo deploy my-components -n my-components\n")])])]),a("p",[e._v("重新更新：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply -f deployment.yaml\n")])])]),a("p",[e._v("查看rollout状态")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl rollout status deploy my-components -n my-components\n")])])]),a("p",[e._v("查看rollout历史")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl rollout "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("history")]),e._v(" deploy my-components -n my-components\n")])])]),a("h4",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pull an Image from a Private Registry"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[e._v("涉及secret创建")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://note.qidong.name/2019/01/pull-private-images-in-k8s/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在Kubernetes中pull私有镜像"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[e._v("涉及secret中namespace的说明")])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);