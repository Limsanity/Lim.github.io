(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{484:function(t,s,a){"use strict";a.r(s);var n=a(46),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"连接远程服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接远程服务器"}},[t._v("#")]),t._v(" 连接远程服务器")]),t._v(" "),a("p",[a("code",[t._v("ssh root@zhonglim")])]),t._v(" "),a("h2",{attrs:{id:"在服务器中全局安装pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在服务器中全局安装pm2"}},[t._v("#")]),t._v(" 在服务器中全局安装pm2")]),t._v(" "),a("p",[a("code",[t._v("npm i pm2 -g")])]),t._v(" "),a("h2",{attrs:{id:"本地项目文件根目录中添加pm2-yml文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地项目文件根目录中添加pm2-yml文件"}},[t._v("#")]),t._v(" 本地项目文件根目录中添加pm2.yml文件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("apps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" vue"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("todo\n    env_production"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" production\n      "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" localhost\n      "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),t._v("\n")])])]),a("ul",[a("li",[t._v("script指运行的文件名")]),t._v(" "),a("li",[t._v("name指定pm2运行后，进程的名字，可以通过pm2 stop name等命令进行操作")]),t._v(" "),a("li",[t._v("HOST\n"),a("ul",[a("li",[t._v("localhost或0.0.0.0，如果使用localhost，需要使用nginx进行反向代理才能从外网进行访问，使用0.0.0.0则不用")])])])]),t._v(" "),a("h2",{attrs:{id:"远程服务器中使用pm2运行程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#远程服务器中使用pm2运行程序"}},[t._v("#")]),t._v(" 远程服务器中使用pm2运行程序")]),t._v(" "),a("ul",[a("li",[t._v("先将本地文件push到github仓库\n"),a("ul",[a("li",[t._v("git init")]),t._v(" "),a("li",[t._v("git add --all")]),t._v(" "),a("li",[t._v('git commit -m "vue learn"')]),t._v(" "),a("li",[t._v("git remote add origin https://github.com/limsanity/vue-learn.git")]),t._v(" "),a("li",[t._v("git push -u origin master")])])]),t._v(" "),a("li",[t._v("在远程服务器中clone仓库并安装依赖\n"),a("ul",[a("li",[t._v("git clone  https://github.com/limsanity/vue-learn.git")]),t._v(" "),a("li",[t._v("npm i")])])]),t._v(" "),a("li",[t._v("pm2运行程序\n"),a("ul",[a("li",[a("code",[t._v("pm2 start pm2.yml --env production")])])])]),t._v(" "),a("li",[t._v("关于pm2的一些常用命令\n"),a("ul",[a("li",[t._v("pm2 stop vue-todo")]),t._v(" "),a("li",[t._v("pm2 list")]),t._v(" "),a("li",[t._v("pm2 log")])])])]),t._v(" "),a("h2",{attrs:{id:"通过外网访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过外网访问"}},[t._v("#")]),t._v(" 通过外网访问")]),t._v(" "),a("h3",{attrs:{id:"pm2-yml中host为0-0-0-0的一些问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2-yml中host为0-0-0-0的一些问题"}},[t._v("#")]),t._v(" pm2.yml中HOST为0.0.0.0的一些问题")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ufw allow 8888")]),t._v("开启端口访问")])]),t._v(" "),a("h3",{attrs:{id:"pm2-yml中host为localhost的一些问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2-yml中host为localhost的一些问题"}},[t._v("#")]),t._v(" pm2.yml中HOST为localhost的一些问题")]),t._v(" "),a("h4",{attrs:{id:"配置nginx反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx反向代理"}},[t._v("#")]),t._v(" 配置Nginx反向代理")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("远程服务器安装nginx：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("apt-get install nginx")])])])]),t._v(" "),a("li",[a("p",[t._v("进入配置文件的路径")]),t._v(" "),a("ul",[a("li",[t._v("cd /etc/nginx/conf.d")])])]),t._v(" "),a("li",[a("p",[t._v("创建配置文件")]),t._v(" "),a("ul",[a("li",[t._v("vim todo.conf")]),t._v(" "),a("li",[t._v("listen为80是因为通过域名访问都是访问到80端口")]),t._v(" "),a("li",[t._v("server_name是要访问的目的地")]),t._v(" "),a("li",[t._v("proxy_pass是服务器将请求转向的目的地，即：127.0.0.1:8888")])])])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("upstream todo "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                                                             \n        server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8888")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                              \n        keepalive "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                                       \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("                                                                           \nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                                                                    \n        listen "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                                          \n        server_name "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("68.183")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".187")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".125")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                         \n                                                                            \n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                                                        \n                proxy_set_header "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IP")]),t._v(" $remote_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                    \n                proxy_set_header "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For $proxy_add_x_forwarded_for"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                proxy_set_header Host $http_host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                           \n                proxy_set_header "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Proxy "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                        \n                proxy_set_header Connection "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                             \n                proxy_pass http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("todo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" # the same "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" upstream name         \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("                                                                   \n                                                                            \n        location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                                                \n                root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("www"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jnode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("                                       \n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("                                                                   \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("                                                                           \n")])])]),a("ul",[a("li",[a("code",[t._v("service nginx reload")]),t._v("重启反向代理服务\n"),a("ul",[a("li",[t._v("输入命令后报错"),a("code",[t._v('See "systemctl status nginx.service" and "journalctl -xe" for details.')]),t._v(" "),a("ul",[a("li",[t._v("journalctl -xe查看原因，可能是端口80被占用，或者todo.conf配置文件写的有问题，我在配置过程中就在listen后加多了个冒号导致重启失败")])])])])])]),t._v(" "),a("h4",{attrs:{id:"配置后依然无法访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置后依然无法访问"}},[t._v("#")]),t._v(" 配置后依然无法访问")]),t._v(" "),a("ul",[a("li",[t._v("一度以为配置出错，可以先在远程服务器中查看\n"),a("ul",[a("li",[a("code",[t._v("curl {your destination}")]),t._v("正常会返回html内容")])])]),t._v(" "),a("li",[t._v("上文有说，通过域名访问的是80端口，我们需要通过ufw allow 80打开80端口，至此，就可以正常访问")])]),t._v(" "),a("h2",{attrs:{id:"补充一些部署过程中出现的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#补充一些部署过程中出现的问题"}},[t._v("#")]),t._v(" 补充一些部署过程中出现的问题")]),t._v(" "),a("h3",{attrs:{id:"npm-run-dev报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-run-dev报错"}},[t._v("#")]),t._v(" npm run dev报错")]),t._v(" "),a("p",[t._v("部署的过程中出去吃饭，然后使用手机对远程服务器进行了操作，一开始npm run dev想看看无法访问的问题是不是出现在配置上，第一次还没有报错，第二次就在端口上报错了。后来一想，出饭店断了wifi后，手机和服务器的连接也随之断开，但之前npm run dev的进程并没有关闭，于是网上查找了一些ubuntu下查看进程的命令：")]),t._v(" "),a("ul",[a("li",[t._v("查看已经连接的服务端口（ESTABLISHED）\n"),a("ul",[a("li",[t._v("netstat -a")])])]),t._v(" "),a("li",[t._v("查看所有的服务端口（LISTEN，ESTABLISHED）\n"),a("ul",[a("li",[t._v("netstat -ap")])])]),t._v(" "),a("li",[t._v("查看指定端口，可以结合grep命令：\n"),a("ul",[a("li",[t._v("netstat -ap | grep 8080")])])]),t._v(" "),a("li",[t._v("若要关闭使用这个端口的程序，使用kill + 对应的pid\n"),a("ul",[a("li",[t._v("kill -9 PID号")])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);